# 协方差

**协方差矩阵**(Covariance matrix)：
$$
\begin{aligned}
\mathrm{Cov}\left[\boldsymbol{X},\boldsymbol{Y}\right]&=\mathbb{E}\left[(\boldsymbol{X}-\mathbb{E}\left[\boldsymbol{X}\right])(\boldsymbol{Y}-\mathbb{E}\left[\boldsymbol{Y}\right])^\mathsf{T}\right]\\
&=\begin{pmatrix}
    \operatorname{Cov}(X_1,Y_1) & \operatorname{Cov}(X_1,Y_2) &\cdots & \operatorname{Cov}(X_1,Y_q) \\
    \operatorname{Cov}(X_2,Y_1) & \operatorname{Cov}(X_2,Y_2) & \cdots & \operatorname{Cov}(X_2,Y_q) \\
    \vdots & \vdots & & \vdots \\
    \operatorname{Cov}(X_p,Y_1) & \operatorname{Cov}(X_p,Y_2) &\cdots & \operatorname{Cov}(X_p,Y_q) \\
\end{pmatrix}
\end{aligned}
$$
若 $\mathbf{Y}=\mathbf{X}$ 时，则称之为方差，简记为 $\Sigma=\operatorname{Cov}[\mathbf{X}]$。易知协方差矩阵*对称且半正定*。

## 协方差与期望

由于
$$
\begin{align}
&\mathbb{E}\left[(\boldsymbol{X}-\mathbb{E}\left[\boldsymbol{X}\right])(\boldsymbol{Y}-\mathbb{E}\left[\boldsymbol{Y}\right])^\mathsf{T}\right] \\
=&\mathbb{E}\left[\boldsymbol{X}\boldsymbol{Y}^\mathsf{T}-\mathbb{E}\left[\boldsymbol{X}\right]\boldsymbol{Y}^\mathsf{T}-\boldsymbol{X}\mathbb{E}\left[\boldsymbol{Y}\right]^\mathsf{T}+\mathbb{E}\left[\boldsymbol{X}\right]\mathbb{E}\left[\boldsymbol{Y}\right]^\mathsf{T}\right] \\ 
=& \mathbb{E}\left[\boldsymbol{X}\boldsymbol{Y}^\mathsf{T}\right]-\mathbb{E}\left[\boldsymbol{X}\right]\mathbb{E}\left[\boldsymbol{Y}\right]^\mathsf{T}-\mathbb{E}\left[\boldsymbol{X}\right]\mathbb{E}\left[\boldsymbol{Y}\right]^\mathsf{T}+\mathbb{E}\left[\boldsymbol{X}\right]\mathbb{E}\left[\boldsymbol{Y}\right]^\mathsf{T}\\
=&\mathbb{E}\left[\boldsymbol{X}\boldsymbol{Y}^\mathsf{T}\right]-\mathbb{E}\left[\boldsymbol{X}\right]\mathbb{E}\left[\boldsymbol{Y}\right]^\mathsf{T}
\end{align}
$$
故
$$\mathbb{E}\left[\boldsymbol{X}\boldsymbol{Y}^\mathsf{T}\right]=\mathrm{Cov}\left[\boldsymbol{X},\boldsymbol{Y}\right]+\mu_{X}\mu_{Y}^\mathsf{T}$$

## 仿射变换后的方差

$$
\begin{align}
\mathrm{Cov}\left[A\boldsymbol{X}+b,C\boldsymbol{Y}+d\right] &= \mathbb{E}\left[A(\boldsymbol{X}-\mathbb{E}\left[\boldsymbol{X}\right])(\boldsymbol{Y}-\mathbb{E}\left[\boldsymbol{Y}\right])^\mathsf{T}C^\mathsf{T}\right] \\
&=A\mathrm{Cov}\left[\boldsymbol{X},\boldsymbol{Y}\right] C^\mathsf{T}
\end{align}
$$

## 相关系数

相关系数矩阵中各元素为对应变量间的相关系数，即
$$\operatorname{corr}(\boldsymbol{x})=
\begin{pmatrix} 
1 & \frac{\mathrm{Cov}[X_1,X_2]}{\sigma_1\sigma_2} & \cdots & \frac{\mathrm{Cov}[X_1,X_D]}{\sigma_1\sigma_D}\\
\frac{\mathrm{Cov}[X_2,X_1]}{\sigma_2\sigma_1} & 1 & \cdots & \frac{\mathrm{Cov}[X_2,X_D]}{\sigma_2\sigma_D}\\
\vdots & \vdots & \ddots & \vdots \\
\frac{\mathrm{Cov}[X_D,X_1]}{\sigma_D\sigma_1} & \frac{\mathbb{E}[(X_D-\mu_D)(X_2-\mu_2)]}{\sigma_D\sigma_2}&\cdots&1
\end{pmatrix}$$


## 相关与独立

若 $\operatorname{Cov}(X,Y)=0$，则称 $X$ 与 $Y$ 不相关。
当 $X$ 与 $Y$ 独立，$\operatorname{Cov}(X,Y)=0$，反之未必。



标准差对角阵：$D^{1 / 2}=\operatorname{diag}(\sqrt{\sigma_{11}},\cdots ,\sqrt{\sigma_{pp}})$

三者间关系为：$\Sigma=D^{1 / 2}RD^{1 / 2}$