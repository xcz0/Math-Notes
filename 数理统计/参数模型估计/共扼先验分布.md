# 共扼先验分布

设 $\theta$ 是总体参数，$\pi(\theta)$ 是其先验分布, 若对任意的样本观测值得到的后验分布 $\pi(\theta|\bf{X})$ 与 $\pi(\theta)$ 属于同一个分布族, 则称该分布族是 $\theta$ 的**共扼先验分布（族）**(conjugate prior distribution)。



设某事件 $A$ 在一次试验中发生的概率为 $\theta$，为估计 $\theta$，对试验进行了 $n$ 次独立观测，其中事件 $A$ 发生了 $X$ 次，显然 $X | \theta \sim b(n, \theta)$，即
$$ P(X=x | \theta)=\binom{n}{x} \theta^{x}(1-\theta)^{n-x}, \quad x=0,1, \cdots, n $$
假若我们在试验前对事件 $A$ 没有什么了解，从对其发生的概率也没有任何信息。在这种场合，贝叶斯本人建议采用“同等无知”的原则，使用区间 $(0,1)$ 上的均匀分布 $U(0,1)$ 作为 $\theta$ 的先验分布。贝叶斯的这个建议被后人称为贝叶斯假设。


先写出 $X$ 和 $\theta$ 的联合分布
$$h(x, \theta)=\binom{n}{x} \theta^x (1-\theta)^{n-x}, \quad x=0,1, \cdots, n, \quad 0<\theta<1$$
然后求 $X$ 的边际分布
$$ m(x)=\binom{n}{x} \int_0^1 \theta^x (1-\theta)^{n - x} \d \theta=\binom{n}{x} \frac{\Gamma(x+1) \Gamma(n-x+1)}{\Gamma(n+2)} $$
最后求出 $\theta$ 的后验分布
$$ \pi(\theta | x) =\frac{h(x, \theta)}{m(x)} =\frac{\Gamma(n+2)}{\Gamma(x+1) \Gamma(n-x+1)} \theta^{(x+1)-1}(1-\theta)^{(n-x+1)-1}, \quad 0<\theta<1 $$

即 $\theta | x \sim B e(x+1, n-x+1)$，故贝塔分布是伯努利试验中成功概率的共枙先验分布。其后验期望估计为
$$ \hat{\theta}_{\mathrm{B}}=E(\theta | x)=\frac{x+1}{n+2} $$

设 $x_1, \cdots, x_n$ 是来自 $N(\mu, \sigma_0^2)$ 的一个样本, 其中 $\sigma_0^2$ 已知，$\mu$ 未知。假设 $\mu$ 的先验分布亦为正态分布 $N(\theta, \tau^2)$，其中先验均值 $\theta$ 和先验方差 $\tau^2$ 均已知，试求 $\mu$ 的贝叶斯估计。
样本 $\bf X$ 的分布和 $\mu$ 的先验分布分别为
$$\begin{align*}
p(\bf{X} | \mu) & = (2 \pi \sigma_0^2)^{-n/2} \exp \left\{-\frac1{2 \sigma_0^2} \sum_{i=1}^n (x_i-\mu)^2\right\} \\
\pi(\mu)        & = (2 \pi \tau^2)^{-1/2} \exp \left\{-\frac1{2 \tau^2}(\mu-\theta)^2 \right\}
\end{align*}$$
由此可以写出 $\bf X$ 与 $\mu$ 的联合分布为
$$h(\bf{X}, \mu)=k_1 \cdot \exp \left\{-\frac12\left[\frac{n\mu^2 - 2n\mu \overline{x}+\sum_{i=1}^n  x_i^2}{\sigma_0^2}+\frac{\mu^2 - 2\theta \mu+\theta^2}{\tau^2}\right]\right\}$$

其中 $\overline{x}=\frac1n  \sum_{i=1}^n  x_i, k_1=(2 \pi)^{-(n+1)/2} \tau^{-1} \sigma_0^{-n}$。若记
$$ A=\frac{n}{\sigma_0^2}+\frac1{\tau^2}, \quad B=\frac{n \overline{x}}{\sigma_0^2}+\frac{\theta}{\tau^2}, \quad C=\frac{\sum_{i=1}^n  x_i^2}{\sigma_0^2}+\frac{\theta^2}{\tau^2} $$
则有
$$\begin{align*}
h(\bf{X}, \mu) & =k_1 \exp \left\{-\frac12[A \mu^2-2 B\mu+C] \right\}               \\
& =k_1 \exp \left\{-\frac{(\mu-B/A)^2}{2/A}-\frac12(C-B^2/A)\right\}
\end{align*}$$
样本的边际密度函数为
$$m(\bf{X})=\int_{-\infty}^{+\infty} h(\bf{X}, \mu) \d\mu=k_1 \exp \left\{-\frac12(C-B^2/A)\right\}(2 \pi/A)^{1/2}$$
应用贝叶斯公式即可得到后验分布
$$\pi(\mu|\bf{X})=\frac{h(\bf{X}, \mu)}{m(\bf{X})}=(2 \pi/A)^{-1/2} \exp \left\{-\frac1{2/A}{(\mu-B/A)^2}\right\}$$
这说明在样本给定后，$\mu$ 的后验分布为 $N(B/A,1/A)$, 即
$$ \mu | \mathbf{X} \sim N\left(\frac{n \overline{x} \tau^2 +\theta\sigma_0^2}{n\tau^2 +\sigma_0^2}, \frac{\sigma_0^2\tau^2}{n \tau^2 +\sigma_0^2}\right) $$


故正态分布是正态总体的共枙先验分布。后验均值即为其贝叶斯估计:
$$ \hat{\mu}=\frac{n\tau^2}{n\tau^2 +\sigma_0^2} \bar{x}+\frac{\sigma_0^2}{n\tau^2 +\sigma_0^2} \theta  $$
它是样本均值 $\bar x$ 与先验均值 $\theta$ 的加权平均. 当总体方差 $\sigma_0^2$ 较小或样本量 $n$ 较大时, 样本均值 $\bar x$ 的权重较大; 当先验方差 $\tau^2$ 较小时, 先验均值 $\theta$ 的权重较大, 这一综合很符合人们的经验。
  
| 总体                     | 参数         | 共轭分布族                                                                                                                                                  |
| ---------------------- | ---------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| $U(\theta-a,\theta+b)$ | $\theta$   | 均匀分布                                                                                                                                                   |
| $B(n,p)$               | $p$        | Beta分布                                                                                                                                                 |
| $Poi(\lambda)$         | $\lambda$  | $\Gamma(\alpha,\beta)\to \Gamma(\alpha+n\bar{x},\beta+n)$                                                                                              |
| $N(\mu,\sigma_0^2)$    | $\mu$      | $N(\theta,\tau^2)\to N\left(\frac{n \overline{x} \tau^2 +\theta\sigma_0^2}{n\tau^2 +\sigma_0^2}, \frac{\sigma_0^2\tau^2}{n \tau^2 +\sigma_0^2}\right)$ |
| $N(\mu,\sigma^2)$      | $\sigma^2$ | $IGa(\alpha,\lambda)\to IGa(\alpha+\frac{n}{2},\beta+\frac{n}{2} \overline{(x-\mu)^2})$                                                                |
