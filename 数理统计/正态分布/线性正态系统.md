# 线性正态系统

若随机变量服从正态分布，而另一随机变量依赖于其的条件分布也为正态分布，且均值为其仿射变换，则称这组变量为线性正态系统：
$$\begin{aligned}
\mathbf{X} & \sim \mathcal{N}(\boldsymbol{x}|\boldsymbol{\mu}_x,\boldsymbol{\Sigma}_x)\\
\mathbf{Y|X} & \sim \mathcal{N}(\boldsymbol{y}|\boldsymbol{Wx}+\boldsymbol{b},\boldsymbol{\Sigma}_y)\end{aligned}$$

## 联合分布

两者的联合密度为 $p(\boldsymbol x,\boldsymbol y)=p(\boldsymbol x)p(\boldsymbol y|\boldsymbol x)$，只考虑其指数项：
$$ -\frac12(\boldsymbol{x}-\boldsymbol{\mu}_x)^T\boldsymbol{\Sigma}_x^{-1}(\boldsymbol{x}-\boldsymbol{\mu}_x)-\frac12(\boldsymbol{y}-\mathbf{W}\boldsymbol{x}-\boldsymbol{b})^T\boldsymbol{\Sigma}_y^{-1}(\boldsymbol{y}-\mathbf{W}\boldsymbol{x}-\boldsymbol{b}) $$
忽略常数项与一次项，只考虑二次项：
$$\begin{aligned}
Q &=-\frac12\boldsymbol{x}^T\boldsymbol{\Sigma}_x^{-1}\boldsymbol{x}-\frac12\boldsymbol{y}^T\boldsymbol{\Sigma}_y^{-1}\boldsymbol{y}-\frac12(\mathbf{W}\boldsymbol{x})^T\boldsymbol{\Sigma}_y^{-1}(\mathbf{W}\boldsymbol{x})+\boldsymbol{y}^T\boldsymbol{\Sigma}_y^{-1}\mathbf{W}\boldsymbol{x} \\
&=-\frac12\begin{pmatrix}\boldsymbol{x}\\\boldsymbol{y}\end{pmatrix}^T\begin{pmatrix}\boldsymbol{\Sigma}_x^{-1}+\mathbf{W}^T\boldsymbol{\Sigma}_y^{-1}\mathbf{W}&-\mathbf{W}^T\boldsymbol{\Sigma}_y^{-1}\\-\boldsymbol{\Sigma}_y^{-1}\mathbf{W}&\boldsymbol{\Sigma}_y^{-1}\end{pmatrix}\begin{pmatrix}\boldsymbol{x}\\ \boldsymbol{y}\end{pmatrix} \\
\end{aligned}$$
所以联合分布的协方差矩阵的逆为：
$$\mathbf{\Sigma}^{-1}=\begin{pmatrix}\mathbf{\Sigma}_x^{-1}+\mathbf{W}^T\mathbf{\Sigma}_y^{-1}\mathbf{W}&-\mathbf{W}^T\mathbf{\Sigma}_y^{-1}\\-\mathbf{\Sigma}_y^{-1}\mathbf{W}&\mathbf{\Sigma}_y^{-1}\end{pmatrix}\triangleq\mathbf{\Lambda}=\begin{pmatrix}\mathbf{\Lambda}_{xx}&\mathbf{\Lambda}_{xy}\\\mathbf{\Lambda}_{yx}&\mathbf{\Lambda}_{yy}\end{pmatrix}$$
通过[[分块矩阵的逆]]计算得：
$$\boldsymbol{\Sigma}=\begin{pmatrix}\boldsymbol{\Sigma}_x&\boldsymbol{\Sigma}_x\mathbf{W}^\intercal\\\mathbf{W}\boldsymbol{\Sigma}_x&\boldsymbol{\Sigma}_y+\mathbf{W}\boldsymbol{\Sigma}_x\mathbf{W}^\intercal\end{pmatrix}$$

由于 $\mathbb{E}[\mathbf{X}]=\mathbf{\mu_x} ,\ \mathbb{E}[\mathbf{Y}]=\mathbb{E}[\mathbb{E}[\mathbf{Y}|\mathbf{X}]]=\mathbf{W\mu_x}+\mathbf{b}$，所以
$$\boldsymbol{\mu}=\begin{pmatrix}\boldsymbol{\mu}_x\\\mathbf{W}\boldsymbol{\mu}_x+\boldsymbol{b}\end{pmatrix}$$

## 后验分布

由[[多元正态分布的条件分布]]可知，其后验分布 $\mathbf{X|Y}$ 也服从正态分布，记为 $\mathcal{N}(\boldsymbol{\mu}_{x|y},\boldsymbol{\Sigma}_{x|y})$。代入得
$$\begin{aligned}
\Sigma_{x|y} &=\boldsymbol{\Lambda}_{xx}^{-1}=(\boldsymbol{\Sigma}_{x}^{-1}+\mathbf{W}^{T}\boldsymbol{\Sigma}_{y}^{-1}\mathbf{W})^{-1} \\
\mu_{x|y} &=\boldsymbol{\Sigma}_{x|y}\left(\boldsymbol{\Lambda}_{xx}\boldsymbol{\mu}_x-\boldsymbol{\Lambda}_{xy}(\boldsymbol{y}-\boldsymbol{\mu}_y)\right) \\
&=\boldsymbol{\Sigma}_{x|y}\left(\boldsymbol{\Sigma}_x^{-1}\boldsymbol{\mu}_x+\mathbf{W}^\mathsf{T}\boldsymbol{\Sigma}_y^{-1}\mathbf{W}\boldsymbol{\mu}_x+\mathbf{W}^\mathsf{T}\boldsymbol{\Sigma}_y^{-1}(\boldsymbol{y}-\boldsymbol{\mu}_y)\right) \\
&=\boldsymbol{\Sigma}_{x|y}\left(\boldsymbol{\Sigma}_x^{-1}\boldsymbol{\mu}_x+\mathbf{W}^{\mathsf{T}}\boldsymbol{\Sigma}_y^{-1}(\mathbf{W}\boldsymbol{\mu}_x+\boldsymbol{y}-\boldsymbol{\mu}_y)\right) \\
&=\boldsymbol{\Sigma}_{x|y}\left(\boldsymbol{\Sigma}_x^{-1}\boldsymbol{\mu}_x+\mathbf{W}^T\boldsymbol{\Sigma}_y^{-1}(\boldsymbol{y}-\boldsymbol{b})\right)
\end{aligned}$$

## 应用

### 推断未知标量

设 $x$ 为一内在特性，对其采样得到数据 $y_i$，采样数据独立同分布，且分布为正态分布，均值为 $x$，方差皆为 $\sigma^2$，记 $\lambda_y=1 / \sigma^2$，则其模型为
$$ p(y_i|x)=\mathcal{N}(y_i|x,\lambda_y^{-1}) $$
假设 $x$ 的先验分布也为正态分布：
$$ p(x)=\mathcal{N}(x|\mu_0,\lambda_{0}^{-1}) $$
套用以上结果：$\mathbf{y}=(y_1,\ \cdots,y_N),\mathbf{W}=\mathbf{1}_N,\ \Sigma^{-1}_y=\lambda_y \mathbf{I}$，代入计算得：
$$\begin{align}
p(x|\mathbf{y}) &= \mathcal{N}(x|\mu_N,\lambda_N^{-1}) \\
\lambda_N &= \boldsymbol{\Lambda}_{xx}=\boldsymbol{\Sigma}_{x}^{-1}+\mathbf{W}^{T}\boldsymbol{\Sigma}_{y}^{-1}\mathbf{W} = \lambda_0+N \lambda_y \\
\mu_N &= \boldsymbol{\Sigma}_{x|y}\left(\boldsymbol{\Sigma}_x^{-1}\boldsymbol{\mu}_x+\mathbf{W}^T\boldsymbol{\Sigma}_y^{-1}(\boldsymbol{y}-\boldsymbol{b})\right) = \lambda_N()
\end{align} $$